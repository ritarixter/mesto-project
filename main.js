(()=>{"use strict";var e=document.querySelector(".popup_type_profile"),t=document.querySelector(".popup_type_card"),n=document.querySelector(".popup_type_image"),o=document.querySelector(".popup_type_avatar"),c=document.querySelector(".popup__btn-profile"),r=document.querySelector(".popup__btn-card"),a=document.querySelector(".popup__btn-image"),u=document.querySelector(".popup__btn-avatar"),i=document.querySelector(".profile__edit-button"),l=document.querySelector(".profile__add-button"),s=document.querySelector(".profile__avatar-container"),d=document.querySelector(".popup__profile-name"),p=document.querySelector(".popup__profile-prof"),_=document.querySelector(".popup__avatar"),f=document.querySelector(".profile__name"),m=document.querySelector(".profile__prof"),v=document.querySelector(".elements"),h=document.querySelector("#template-element").content,y=document.querySelector(".popup__card-name"),S=document.querySelector(".popup__card-link"),b=(document.querySelectorAll(".popup"),document.querySelector(".popup__label")),q=document.querySelector(".popup__img"),L=document.querySelector(".profile__avatar"),E=document.querySelector(".popup__avatar-save"),g=document.querySelector(".popup__card-save"),k=document.querySelector(".popup__profile-save"),C="fd31c0b0-ebe1-41cb-8f59-11585798d188",x="plus-cohort-2",A="https://nomoreparties.co/v1";function T(e){"Escape"===e.key&&B(document.querySelector(".popup_opened"))}function z(e){e.classList.add("popup_opened"),document.addEventListener("keydown",T)}function B(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",T)}function j(e){e.target.classList.contains("popup")&&B(e.target)}var P=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function w(e,t,o,c,r,a){var u=h.querySelector(".element").cloneNode(!0),i=u.querySelector(".element__image"),l=u.querySelector(".element__like-number"),s=u.querySelector(".element__delete"),d=u.querySelector(".element__btn");return l.textContent=o,i.src=e,i.alt=t,u.querySelector(".element__name").textContent=t,o>0?a.forEach((function(e){"6933cfbb3192ddb277b680f1"===e._id&&d.classList.add("element__btn_active")})):l.textContent=0,"6933cfbb3192ddb277b680f1"!==c?s.classList.add("element__delete_hidden"):(s.classList.remove("element__delete_hidden"),s.addEventListener("click",(function(e){var t;(t=r,fetch("".concat(A,"/").concat(x,"/cards/").concat(t),{method:"DELETE",headers:{authorization:C}}).then(P)).then((function(){e.target.closest(".element").remove()})).catch((function(e){return console.log(e)}))}))),d.addEventListener("click",(function(e){var t;e.target.classList.contains("element__btn_active")?(t=r,fetch("".concat(A,"/").concat(x,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:C}}).then(P)).then((function(t){e.target.classList.remove("element__btn_active"),l.textContent=t.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(A,"/").concat(x,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:C}}).then(P)}(r).then((function(t){e.target.classList.add("element__btn_active"),l.textContent=t.likes.length})).catch((function(e){console.log(e)}))})),i.addEventListener("click",(function(e){z(n),q.src=e.target.src,q.alt=e.target.alt,b.textContent=e.target.alt})),u}function N(e){var t=e.getAttribute("name");return document.getElementById(t+"-error")}function O(e,t){e.setAttribute("disabled","disabled"),e.classList.add(t)}var D,J=function(e,t,n){e.textContent=t?"Сохранение...":n};i.addEventListener("click",(function(){z(e),d.value=f.textContent,p.value=m.textContent})),l.addEventListener("click",(function(){z(t)})),s.addEventListener("click",(function(){z(o)})),c.addEventListener("click",(function(){B(e)})),r.addEventListener("click",(function(){B(t)})),a.addEventListener("click",(function(){B(n)})),u.addEventListener("click",(function(){B(o)})),e.addEventListener("submit",(function(){var t,n;J(k,!0),(t=d.value,n=p.value,fetch("".concat(A,"/").concat(x,"/users/me"),{method:"PATCH",headers:{authorization:C,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then(P)).then((function(){f.textContent=d.value,m.textContent=p.value,B(e)})).catch((function(e){console.log(e)})).finally((function(){return J(k,!1,"Сохранить")}))})),t.addEventListener("submit",(function(){var e,n;J(g,!0),(e=S.value,n=y.value,fetch("".concat(A,"/").concat(x,"/cards"),{method:"POST",headers:{authorization:C,"Content-Type":"application/json"},body:JSON.stringify({name:n,link:e})}).then(P)).then((function(e){v.prepend(w(e.link,e.name,e.likes.length,e.owner._id,e._id,e.likes)),B(t),y.value="",S.value=""})).catch((function(e){console.log(e)})).finally((function(){return J(g,!1,"Сохранить")}))})),o.addEventListener("submit",(function(){var e=_.value;J(E,!0),function(e){return fetch("".concat(A,"/").concat(x,"/users/me/avatar"),{method:"PATCH",headers:{authorization:C,"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(e)})}).then(P)}(e).then((function(t){L.src=e,B(o)})).catch((function(e){console.log(e)})).finally((function(){return J(E,!1,"Сохранить")}))})),e.addEventListener("click",j),t.addEventListener("click",j),n.addEventListener("click",j),o.addEventListener("click",j),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(D.formSelector)).forEach((function(e){var t=Array.from(e.querySelectorAll(D.inputSelector));t.forEach((function(n){n.addEventListener("input",(function(o){!function(e,t,n){e.validity.valid?function(e,t,n,o){e.textContent="",e.classList.remove(t),n.classList.remove(o)}(N(e),t,e,n):function(e,t,n,o){e.textContent=n.validationMessage,e.classList.add(t),n.classList.add(o)}(N(e),t,e,n)}(n,D.errorClass,D.inputErrorClass),function(e,t,n,o){var c=n.querySelector(t);e.every((function(e){return e.validity.valid}))?(c.removeAttribute("disabled"),c.classList.remove(o)):O(c,o)}(t,D.submitButtonSelector,e,D.inactiveButtonClass)}))})),e.addEventListener("submit",(function(t){t.preventDefault(),O(e.querySelector(D.submitButtonSelector),D.inactiveButtonClass)}))})),fetch("".concat(A,"/").concat(x,"/users/me"),{headers:{authorization:C}}).then(P).then((function(e){f.textContent=e.name,m.textContent=e.about,L.src=e.avatar})).catch((function(e){console.log(e)})),fetch("".concat(A,"/").concat(x,"/cards"),{headers:{authorization:C}}).then(P).then((function(e){e.forEach((function(e){v.prepend(w(e.link,e.name,e.likes.length,e.owner._id,e._id,e.likes))}))})).catch((function(e){console.log(e)}))})();